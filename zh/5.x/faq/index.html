<!doctype html>
<html class="docs-version-5.x" lang="zh" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.9">
<link rel="alternate" type="application/rss+xml" href="/zh/blog/rss.xml" title="pnpm RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/zh/blog/atom.xml" title="pnpm Atom Feed">
<link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-91385296-1"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","UA-91385296-1",{anonymize_ip:!0})</script>
<link rel="search" type="application/opensearchdescription+xml" title="pnpm" href="/zh/opensearch.xml">
<script src="https://buttons.github.io/buttons.js"></script><title data-react-helmet="true">常见问题 | pnpm</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:image" content="https://pnpm.io/zh/img/ogimage.png"><meta data-react-helmet="true" name="twitter:image" content="https://pnpm.io/zh/img/ogimage.png"><meta data-react-helmet="true" property="og:url" content="https://pnpm.io/zh/5.x/faq"><meta data-react-helmet="true" name="docsearch:language" content="zh"><meta data-react-helmet="true" name="docsearch:version" content="5.x"><meta data-react-helmet="true" name="docsearch:docusaurus_tag" content="docs-default-5.x"><meta data-react-helmet="true" property="og:title" content="常见问题 | pnpm"><meta data-react-helmet="true" name="description" content="如果包存储在全局存储中，为什么我的 node_modules 使用了磁盘空间？"><meta data-react-helmet="true" property="og:description" content="如果包存储在全局存储中，为什么我的 node_modules 使用了磁盘空间？"><link data-react-helmet="true" rel="shortcut icon" href="/zh/img/favicon.png"><link data-react-helmet="true" rel="canonical" href="https://pnpm.io/zh/5.x/faq"><link data-react-helmet="true" rel="alternate" href="https://pnpm.io/5.x/faq" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://pnpm.io/it/5.x/faq" hreflang="it"><link data-react-helmet="true" rel="alternate" href="https://pnpm.io/zh/5.x/faq" hreflang="zh"><link data-react-helmet="true" rel="alternate" href="https://pnpm.io/ja/5.x/faq" hreflang="ja"><link data-react-helmet="true" rel="alternate" href="https://pnpm.io/ru/5.x/faq" hreflang="ru"><link data-react-helmet="true" rel="alternate" href="https://pnpm.io/tr/5.x/faq" hreflang="tr"><link data-react-helmet="true" rel="alternate" href="https://pnpm.io/pt/5.x/faq" hreflang="pt"><link data-react-helmet="true" rel="alternate" href="https://pnpm.io/fr/5.x/faq" hreflang="fr"><link data-react-helmet="true" rel="alternate" href="https://pnpm.io/pl/5.x/faq" hreflang="pl"><link data-react-helmet="true" rel="alternate" href="https://pnpm.io/es/5.x/faq" hreflang="es"><link data-react-helmet="true" rel="alternate" href="https://pnpm.io/hu/5.x/faq" hreflang="hu"><link data-react-helmet="true" rel="alternate" href="https://pnpm.io/5.x/faq" hreflang="x-default"><link data-react-helmet="true" rel="preconnect" href="https://BH4D9OD16A-dsn.algolia.net" crossorigin="anonymous"><link rel="stylesheet" href="/zh/assets/css/styles.0292cfa2.css">
<link rel="preload" href="/zh/assets/js/runtime~main.a99dfb90.js" as="script">
<link rel="preload" href="/zh/assets/js/main.148a877f.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_1JeC">跳到主内容</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/zh/"><div class="navbar__logo"><img src="/zh/img/pnpm-no-name-with-frame.svg" alt="pnpm" class="themedImage_25oJ themedImage--light_1c4H"><img src="/zh/img/pnpm-no-name-with-frame.svg" alt="pnpm" class="themedImage_25oJ themedImage--dark_xp-I"></div><b class="navbar__title">pnpm</b></a><a class="navbar__item navbar__link" href="/zh/motivation">文档</a><a class="navbar__item navbar__link" href="/zh/blog">博客</a><a class="navbar__item navbar__link" href="/zh/faq">常见问题及解答</a><a class="navbar__item navbar__link" href="/zh/community">社区</a><a class="navbar__item navbar__link" href="/zh/benchmarks">Benchmarks</a></div><div class="navbar__items navbar__items--right"><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a class="navbar__link" href="/zh/5.x/motivation">5.x</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/zh/next/faq">Next</a></li><li><a class="dropdown__link" href="/zh/faq">6.x</a></li><li><a aria-current="page" class="dropdown__link dropdown__link--active" href="/zh/5.x/faq">5.x</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" class="navbar__link"><span><svg viewBox="0 0 20 20" width="20" height="20" aria-hidden="true" class="iconLanguage_10wW"><path fill="currentColor" d="M19.753 10.909c-.624-1.707-2.366-2.726-4.661-2.726-.09 0-.176.002-.262.006l-.016-2.063 3.525-.607c.115-.019.133-.119.109-.231-.023-.111-.167-.883-.188-.976-.027-.131-.102-.127-.207-.109-.104.018-3.25.461-3.25.461l-.013-2.078c-.001-.125-.069-.158-.194-.156l-1.025.016c-.105.002-.164.049-.162.148l.033 2.307s-3.061.527-3.144.543c-.084.014-.17.053-.151.143.019.09.19 1.094.208 1.172.018.08.072.129.188.107l2.924-.504.035 2.018c-1.077.281-1.801.824-2.256 1.303-.768.807-1.207 1.887-1.207 2.963 0 1.586.971 2.529 2.328 2.695 3.162.387 5.119-3.06 5.769-4.715 1.097 1.506.256 4.354-2.094 5.98-.043.029-.098.129-.033.207l.619.756c.08.096.206.059.256.023 2.51-1.73 3.661-4.515 2.869-6.683zm-7.386 3.188c-.966-.121-.944-.914-.944-1.453 0-.773.327-1.58.876-2.156a3.21 3.21 0 011.229-.799l.082 4.277a2.773 2.773 0 01-1.243.131zm2.427-.553l.046-4.109c.084-.004.166-.01.252-.01.773 0 1.494.145 1.885.361.391.217-1.023 2.713-2.183 3.758zm-8.95-7.668a.196.196 0 00-.196-.145h-1.95a.194.194 0 00-.194.144L.008 16.916c-.017.051-.011.076.062.076h1.733c.075 0 .099-.023.114-.072l1.008-3.318h3.496l1.008 3.318c.016.049.039.072.113.072h1.734c.072 0 .078-.025.062-.076-.014-.05-3.083-9.741-3.494-11.04zm-2.618 6.318l1.447-5.25 1.447 5.25H3.226z"></path></svg><span>中文 (50%)</span></span></a><ul class="dropdown__menu"><li><a href="/5.x/faq" target="_self" rel="noopener noreferrer" class="dropdown__link" style="text-transform:capitalize">English</a></li><li><a href="/it/5.x/faq" target="_self" rel="noopener noreferrer" class="dropdown__link" style="text-transform:capitalize">Italiano (100%)</a></li><li><a href="/zh/5.x/faq" target="_self" rel="noopener noreferrer" class="dropdown__link dropdown__link--active" style="text-transform:capitalize">中文 (50%)</a></li><li><a href="/ja/5.x/faq" target="_self" rel="noopener noreferrer" class="dropdown__link" style="text-transform:capitalize">日本語 (41%)</a></li><li><a href="/ru/5.x/faq" target="_self" rel="noopener noreferrer" class="dropdown__link" style="text-transform:capitalize">Русский (29%)</a></li><li><a href="/tr/5.x/faq" target="_self" rel="noopener noreferrer" class="dropdown__link" style="text-transform:capitalize">Türkçe (18%)</a></li><li><a href="/pt/5.x/faq" target="_self" rel="noopener noreferrer" class="dropdown__link" style="text-transform:capitalize">Português Brasileiro (16%)</a></li><li><a href="/fr/5.x/faq" target="_self" rel="noopener noreferrer" class="dropdown__link" style="text-transform:capitalize">Français (13%)</a></li><li><a href="/pl/5.x/faq" target="_self" rel="noopener noreferrer" class="dropdown__link" style="text-transform:capitalize">Polski (8%)</a></li><li><a href="/es/5.x/faq" target="_self" rel="noopener noreferrer" class="dropdown__link" style="text-transform:capitalize">Español (6%)</a></li><li><a href="/hu/5.x/faq" target="_self" rel="noopener noreferrer" class="dropdown__link" style="text-transform:capitalize">Magyar (4%)</a></li><li><a href="https://crowdin.com/project/pnpm" target="_blank" rel="noopener noreferrer" class="dropdown__link">Help Us Translate</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a class="navbar__link">🧡 赞助我们</a><ul class="dropdown__menu"><li><a href="https://opencollective.com/pnpm" target="_blank" rel="noopener noreferrer" class="dropdown__link"><span>Open Collective<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_1EiD"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li><a href="https://github.com/sponsors/pnpm" target="_blank" rel="noopener noreferrer" class="dropdown__link"><span>GitHub Sponsors<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_1EiD"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li><a class="dropdown__link" href="/zh/crypto-donations">加密捐赠</a></li></ul></div><a href="https://github.com/pnpm/pnpm" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-github-link" aria-label="GitHub repository"></a><div class="toggle_uiV1 toggle_1CP8 toggleDisabled_1n8m"><div class="toggleTrack_2t7p" role="button" tabindex="-1"><div class="toggleTrackCheck_12D7"><span class="toggleIcon_ZBxH">🌜</span></div><div class="toggleTrackX_29Ej"><span class="toggleIcon_ZBxH">🌞</span></div><div class="toggleTrackThumb_2tVa"></div></div><input type="checkbox" class="toggleScreenReader_2VAL" aria-label="Switch between dark and light mode"></div><div class="searchBox_2V2x"><button type="button" class="DocSearch DocSearch-Button" aria-label="搜索"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">搜索</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper docs-doc-page"><div class="docPage_1vLO"><button aria-label="回到顶部" class="clean-btn theme-back-to-top-button backToTopButton_3Zdd" type="button"></button><main class="docMainContainer_1yhC docMainContainerEnhanced_Pt5e"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_2vk1"><div class="theme-doc-version-banner alert alert--warning margin-bottom--md" role="alert"><div>这是已不再维护的 <!-- -->pnpm<!-- --> <b>5.x</b> 版本文档。</div><div class="margin-top--md">要查看最新文档，请参见<b><a href="/zh/faq">最新版本</a></b> (<!-- -->6.x<!-- -->)。</div></div><div class="docItemContainer_hp59"><article><span class="theme-doc-version-badge badge badge--secondary">Version: <!-- -->5.x</span><div class="tocCollapsible_ypLO theme-doc-toc-mobile tocMobile_3UkC"><button type="button" class="clean-btn tocCollapsibleButton_3WmI">在此页面</button></div><div class="theme-doc-markdown markdown"><header><h1>常见问题</h1></header><h2 class="anchor anchorWithStickyNavbar_2sLg" id="如果包存储在全局存储中为什么我的-node_modules-使用了磁盘空间">如果包存储在全局存储中，为什么我的 <code>node_modules</code> 使用了磁盘空间？<a aria-hidden="true" class="hash-link" href="#如果包存储在全局存储中为什么我的-node_modules-使用了磁盘空间" title="直接链接到此标题">​</a></h2><p>pnpm 创建从全局存储到项目下 <code>node_modules</code> 文件夹的 <a href="https://en.wikipedia.org/wiki/Hard_link" target="_blank" rel="noopener noreferrer">硬链接</a>。 硬链接指向磁盘上原始文件所在的同一位置。 因此，例如，如果您的项目中 <code>foo</code> 并且它占用 1MB 的空间，那么看起来它在项目的 <code>node_modules</code> 文件夹中占用了与全局存储相同的 1MB 的空间。 但是，该 1MB 是磁盘上两个不同位置的<em>相同空间</em> 。 所以 <code>foo</code> 总共占用 1MB，而不是 2MB。</p><p>获取有关此主题的更多信息：</p><ul><li><a href="https://unix.stackexchange.com/questions/88423/why-do-hard-links-seem-to-take-the-same-space-as-the-originals" target="_blank" rel="noopener noreferrer">为什么硬链接似乎与原始链接占用相同的空间？</a></li><li><a href="https://gist.github.com/zkochan/106cfef49f8476b753a9cbbf9c65aff1" target="_blank" rel="noopener noreferrer">Pnpm 聊天室的一个帖子</a></li><li><a href="https://github.com/pnpm/pnpm/issues/794" target="_blank" rel="noopener noreferrer">Pnpm repo中的一个 issue</a></li></ul><h2 class="anchor anchorWithStickyNavbar_2sLg" id="能用于windows吗">能用于Windows吗？<a aria-hidden="true" class="hash-link" href="#能用于windows吗" title="直接链接到此标题">​</a></h2><p>短回答：当然</p><p>长答案：在 Windows 上使用符号链接至少可以说是有问题的，但是，pnpm 有一个解决方法。 对于 Windows，我们用<a href="https://docs.microsoft.com/en-us/windows/win32/fileio/hard-links-and-junctions" target="_blank" rel="noopener noreferrer">junctions</a>替代。</p><h2 class="anchor anchorWithStickyNavbar_2sLg" id="但是嵌套的-node_modules-组织方式与-windows-兼容吗">但是嵌套的 <code>node_modules</code> 组织方式与 Windows 兼容吗？<a aria-hidden="true" class="hash-link" href="#但是嵌套的-node_modules-组织方式与-windows-兼容吗" title="直接链接到此标题">​</a></h2><p>Npm 的早期版本由于嵌套了所有 <code>node_modules</code> (参见 <a href="https://github.com/nodejs/node-v0.x-archive/issues/6960" target="_blank" rel="noopener noreferrer">这个 issue</a>. 但是，pnpm 不会创建深层文件夹，它使用符号链接来创建依赖关系树结构。</p><h2 class="anchor anchorWithStickyNavbar_2sLg" id="循环-symlinks-呢">循环 symlinks 呢?<a aria-hidden="true" class="hash-link" href="#循环-symlinks-呢" title="直接链接到此标题">​</a></h2><p>尽管 pnpm 使用链接将依赖项放入 <code>node_modules</code> 文件夹，循环的符号链接已经被避免了，因为父包放置在其依赖项所在 <code>node_modules</code> 文件夹中。 所以 <code>foo</code>的依赖项不在 <code>foo/node_modules</code> 中，<code>foo</code> 其实和它 依赖项一起在 <code>node_modules</code> 中。</p><h2 class="anchor anchorWithStickyNavbar_2sLg" id="为什么有硬链接-为什么不直接符号链接到全局存储">为什么有硬链接？ 为什么不直接符号链接到全局存储？<a aria-hidden="true" class="hash-link" href="#为什么有硬链接-为什么不直接符号链接到全局存储" title="直接链接到此标题">​</a></h2><p>一台机器上一个包在可以有不同的依赖集。</p><p>在项目 <strong>A</strong> <code>foo@1.0.0</code> 可以具有一个依赖被解析为 <code>bar@1.0.0</code>，但在项目 <strong>B</strong> 中 <code>foo</code> 的依赖可能会被解析至 <code>bar@1.1.0</code>; 因此，pnpm 硬链接 <code>foo@1.0.0</code> 到每个使用它的项目，以便为其创建不同的依赖项集。</p><p>直接软链至全局存储与 Node 的 <code>--preserve-symlinks</code> 标志一起使用是可行的，但是，该方法附带了个自己的问题，因此我们决定使用硬链接。 有关为何作出决定的详情，请参阅 <a href="https://github.com/nodejs/node-eps/issues/46" target="_blank" rel="noopener noreferrer">这个 issue</a>。</p><h2 class="anchor anchorWithStickyNavbar_2sLg" id="pnpm-是否可以跨多个驱动器或文件系统工作">Pnpm 是否可以跨多个驱动器或文件系统工作？<a aria-hidden="true" class="hash-link" href="#pnpm-是否可以跨多个驱动器或文件系统工作" title="直接链接到此标题">​</a></h2><p>包存储应与安装的位置处于同一驱动器和文件系统上，否则，包将被复制，而不是被链接。 这是由于硬链接的工作方式带来的一个限制，因为一个文件系统上的文件无法寻址另一个文件系统中的位置。 有关更多详细信息，请参阅 <a href="https://github.com/pnpm/pnpm/issues/712" target="_blank" rel="noopener noreferrer">issue #712</a>。</p><p>pnpm 在以下两种情况下的功能有所不同：</p><h3 class="anchor anchorWithStickyNavbar_2sLg" id="存储路径已指定">存储路径已指定<a aria-hidden="true" class="hash-link" href="#存储路径已指定" title="直接链接到此标题">​</a></h3><p>If the store path is specified via <a href="/zh/5.x/configuring">the store config</a>, then copying occurs between the store and any projects that are on a different disk.</p><p>If you run <code>pnpm install</code> on disk <code>A</code>, then the pnpm store must be on disk <code>A</code>. If the pnpm store is located on disk <code>B</code>, then all required packages will be directly copied to the project location instead of being linked. This severely inhibits the storage and performance benefits of pnpm.</p><h3 class="anchor anchorWithStickyNavbar_2sLg" id="存储路径未指定">存储路径未指定<a aria-hidden="true" class="hash-link" href="#存储路径未指定" title="直接链接到此标题">​</a></h3><p>If the store path is not set, then multiple stores are created (one per drive or filesystem).</p><p>If installation is run on disk <code>A</code>, the store will be created on <code>A</code> <code>.pnpm-store</code> under the filesystem root.  If later the installation is run on disk <code>B</code>, an independent store will be created on <code>B</code> at <code>.pnpm-store</code>. The projects would still maintain the benefits of pnpm, but each drive may have redundant packages.</p><h2 class="anchor anchorWithStickyNavbar_2sLg" id="pnpm-store-prune的作用是-是否有害"><code>pnpm store prune</code>的作用是？ 是否有害？<a aria-hidden="true" class="hash-link" href="#pnpm-store-prune的作用是-是否有害" title="直接链接到此标题">​</a></h2><p>The command <code>pnpm store prune</code> removes <em>unreferenced packages</em>.</p><p>Unreferenced packages are packages that are not used by any projects on the system. Packages can become unreferenced after most installation operations, for instance when dependencies are made redundant.</p><p>For example, during <code>pnpm install</code>, package <code>foo@1.0.0</code> is updated to <code>foo@1.0.1</code>. pnpm will keep <code>foo@1.0.0</code> in the store, as it does not automatically remove packages. If package <code>foo@1.0.0</code> is not used by any other project on the system, it becomes unreferenced. Running <code>pnpm store prune</code> would remove <code>foo@1.0.0</code> from the store.</p><p>Running <code>pnpm store prune</code> is not harmful and has no side effects on your projects. If future installations require removed packages, pnpm will download them again.</p><p>It is best practice to run <code>pnpm store prune</code> occasionally to clean up the store, but not too frequently. Sometimes, unreferenced packages become required again. This could occur when switching branches and installing older dependencies, in which case pnpm would need to re-download all removed packages, briefly slowing down the installation process.</p><h2 class="anchor anchorWithStickyNavbar_2sLg" id="pnpm-代表什么"><code>pnpm</code> 代表什么？<a aria-hidden="true" class="hash-link" href="#pnpm-代表什么" title="直接链接到此标题">​</a></h2><p><code>pnpm</code> 代表 高性能<code> npm</code>。 <a href="https://github.com/rstacruz/" target="_blank" rel="noopener noreferrer">@rstacruz</a>想出了这个名字。</p><h2 class="anchor anchorWithStickyNavbar_2sLg" id="pnpm-does-not-work-with-your-project-here"><code>pnpm</code> does not work with <!-- -->&lt;<!-- -->YOUR-PROJECT-HERE&gt;?<a aria-hidden="true" class="hash-link" href="#pnpm-does-not-work-with-your-project-here" title="直接链接到此标题">​</a></h2><p>In most cases it means that one of the dependencies require packages not declared in <code>package.json</code>. It is a common mistake caused by flat <code>node_modules</code>. If this happens, this is an error in the dependency and the dependency should be fixed. That might take time though, so pnpm supports workarounds to make the buggy packages work.</p><h3 class="anchor anchorWithStickyNavbar_2sLg" id="解决方案1">解决方案1<a aria-hidden="true" class="hash-link" href="#解决方案1" title="直接链接到此标题">​</a></h3><p>In the following example, a dependency does <strong>not</strong> have the <code>iterall</code> module in its own list of deps.</p><p>The easiest solution to resolve missing dependencies of the buggy packages is to <strong>add <code>iterall</code> as a dependency to our project&#x27;s <code>package.json</code></strong>.</p><p>You can do so, by installing it via <code>pnpm add iterall</code>, and will be automatically added to your project&#x27;s <code>package.json</code>.</p><div class="codeBlockContainer_2rp7"><div class="codeBlockContent_1cc9 json"><pre tabindex="0" class="prism-code language-json codeBlock_2YR0 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1Jrx"><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;dependencies&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;iterall&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;^1.2.2&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="复制代码" class="copyButton_2qx9 clean-btn">复制</button></div></div><h3 class="anchor anchorWithStickyNavbar_2sLg" id="解决方案2">解决方案2<a aria-hidden="true" class="hash-link" href="#解决方案2" title="直接链接到此标题">​</a></h3><p>One of the solutions is to use <a href="/zh/5.x/pnpmfile#hooks">hooks</a> for adding the missing dependencies to the package&#x27;s <code>package.json</code>.</p><p>An example was <a href="https://github.com/pnpm/pnpm/issues/1043" target="_blank" rel="noopener noreferrer">Webpack Dashboard</a> which wasn&#x27;t working with <code>pnpm</code>. It has since been resolved such that it works with <code>pnpm</code> now.</p><p>It used to throw an error:</p><div class="codeBlockContainer_2rp7"><div class="codeBlockContent_1cc9 console"><pre tabindex="0" class="prism-code language-console codeBlock_2YR0 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1Jrx"><span class="token-line" style="color:#393A34"><span class="token plain">Error: Cannot find module &#x27;babel-traverse&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  at /node_modules/inspectpack@2.2.3/node_modules/inspectpack/lib/actions/parse</span><br></span></code></pre><button type="button" aria-label="复制代码" class="copyButton_2qx9 clean-btn">复制</button></div></div><p>The problem was that <code>babel-traverse</code> was used in <code>inspectpack</code> which was used by <code>webpack-dashboard</code>, but <code>babel-traverse</code> wasn&#x27;t specified in <code>inspectpack</code>&#x27;s <code>package.json</code>. It still worked with <code>npm</code> and <code>yarn</code> because they create flat <code>node_modules</code>.</p><p>The solution was to create a <code>pnpmfile.js</code> with the following contents:</p><div class="codeBlockContainer_2rp7"><div class="codeBlockContent_1cc9 js"><pre tabindex="0" class="prism-code language-js codeBlock_2YR0 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1Jrx"><span class="token-line" style="color:#393A34"><span class="token plain">module</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">exports</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  hooks</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function-variable function" style="color:#d73a49">readPackage</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">pkg</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token keyword control-flow" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">pkg</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">name</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">===</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;inspectpack&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        pkg</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">dependencies</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&#x27;babel-traverse&#x27;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;^6.26.0&#x27;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token keyword control-flow" style="color:#00009f">return</span><span class="token plain"> pkg</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><button type="button" aria-label="复制代码" class="copyButton_2qx9 clean-btn">复制</button></div></div><p>After creating a <code>pnpmfile.js</code>, delete <code>pnpm-lock.yaml</code> only - there is no need to delete <code>node_modules</code>, as pnpm hooks only effect module resolution. Then, rebuild the dependencies &amp; it should be working.</p><h3 class="anchor anchorWithStickyNavbar_2sLg" id="解决方案3">解决方案3<a aria-hidden="true" class="hash-link" href="#解决方案3" title="直接链接到此标题">​</a></h3><p>In case there are too many issues, you can use the <code>shamefully-hoist</code> option. This creates a flat <code>node_modules</code> structure similar to the one created by <code>npm</code> or <code>yarn</code>, which is not recommended as avoiding this structure is the primary purpose of pnpm&#x27;s <code>node_modules</code> approach.</p><p>To use it, try <code>pnpm install --shamefully-hoist</code>.</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://crowdin.com/project/pnpm/zh-CN" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_3cd2" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>编辑此页面</a></div><div class="col lastUpdated_3rdC"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="文档导航"><div class="pagination-nav__item"></div><div class="pagination-nav__item pagination-nav__item--next"></div></nav></div></div><div class="col col--3"><div class="tableOfContents_1AQL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#如果包存储在全局存储中为什么我的-node_modules-使用了磁盘空间" class="table-of-contents__link toc-highlight">如果包存储在全局存储中，为什么我的 <code>node_modules</code> 使用了磁盘空间？</a></li><li><a href="#能用于windows吗" class="table-of-contents__link toc-highlight">能用于Windows吗？</a></li><li><a href="#但是嵌套的-node_modules-组织方式与-windows-兼容吗" class="table-of-contents__link toc-highlight">但是嵌套的 <code>node_modules</code> 组织方式与 Windows 兼容吗？</a></li><li><a href="#循环-symlinks-呢" class="table-of-contents__link toc-highlight">循环 symlinks 呢?</a></li><li><a href="#为什么有硬链接-为什么不直接符号链接到全局存储" class="table-of-contents__link toc-highlight">为什么有硬链接？ 为什么不直接符号链接到全局存储？</a></li><li><a href="#pnpm-是否可以跨多个驱动器或文件系统工作" class="table-of-contents__link toc-highlight">Pnpm 是否可以跨多个驱动器或文件系统工作？</a><ul><li><a href="#存储路径已指定" class="table-of-contents__link toc-highlight">存储路径已指定</a></li><li><a href="#存储路径未指定" class="table-of-contents__link toc-highlight">存储路径未指定</a></li></ul></li><li><a href="#pnpm-store-prune的作用是-是否有害" class="table-of-contents__link toc-highlight"><code>pnpm store prune</code>的作用是？ 是否有害？</a></li><li><a href="#pnpm-代表什么" class="table-of-contents__link toc-highlight"><code>pnpm</code> 代表什么？</a></li><li><a href="#pnpm-does-not-work-with-your-project-here" class="table-of-contents__link toc-highlight"><code>pnpm</code> does not work with &lt;YOUR-PROJECT-HERE&gt;?</a><ul><li><a href="#解决方案1" class="table-of-contents__link toc-highlight">解决方案1</a></li><li><a href="#解决方案2" class="table-of-contents__link toc-highlight">解决方案2</a></li><li><a href="#解决方案3" class="table-of-contents__link toc-highlight">解决方案3</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">文档</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/zh/installation">入门</a></li><li class="footer__item"><a class="footer__link-item" href="/zh/pnpm-cli">pnpm CLI</a></li><li class="footer__item"><a class="footer__link-item" href="/zh/workspaces">工作空间</a></li><li class="footer__item"><a class="footer__link-item" href="/zh/npmrc">.npmrc</a></li></ul></div><div class="col footer__col"><div class="footer__title">社区</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/zh/users">用户展示</a></li><li class="footer__item"><a href="https://stackoverflow.com/questions/tagged/pnpm" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Stack Overflow<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_1EiD"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://r.pnpm.io/chat" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>项目聊天<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_1EiD"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://twitter.com/pnpmjs" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_1EiD"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div><div class="col footer__col"><div class="footer__title">参与贡献</div><ul class="footer__items"><li class="footer__item"><a href="https://github.com/pnpm/pnpm" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_1EiD"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://crowdin.com/project/pnpm" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>帮助我们翻译<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_1EiD"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div><div class="col footer__col"><ul class="footer__items"><li class="footer__item"><a href="https://www.netlify.com">
  <img src="https://www.netlify.com/img/global/badges/netlify-light.svg" alt="Deploys by Netlify">
</a></li></ul></div></div><div class="footer__bottom text--center"><div class="margin-bottom--sm"><img src="/zh/img/pnpm-light.svg" alt="" class="themedImage_25oJ themedImage--light_1c4H footer__logo"><img src="/zh/img/pnpm-light.svg" alt="" class="themedImage_25oJ themedImage--dark_xp-I footer__logo"></div><div class="footer__copyright">版权所有 © 2015-2021 pnpm 贡献者</div></div></div></footer></div>
<script src="/zh/assets/js/runtime~main.a99dfb90.js"></script>
<script src="/zh/assets/js/main.148a877f.js"></script>
</body>
</html>