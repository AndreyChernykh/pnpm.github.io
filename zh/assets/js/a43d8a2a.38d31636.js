"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[4211],{9613:(e,n,t)=>{t.d(n,{Zo:()=>d,kt:()=>u});var a=t(9496);function o(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function p(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);n&&(a=a.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,a)}return t}function i(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?p(Object(t),!0).forEach((function(n){o(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):p(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function r(e,n){if(null==e)return{};var t,a,o=function(e,n){if(null==e)return{};var t,a,o={},p=Object.keys(e);for(a=0;a<p.length;a++)t=p[a],n.indexOf(t)>=0||(o[t]=e[t]);return o}(e,n);if(Object.getOwnPropertySymbols){var p=Object.getOwnPropertySymbols(e);for(a=0;a<p.length;a++)t=p[a],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(o[t]=e[t])}return o}var l=a.createContext({}),s=function(e){var n=a.useContext(l),t=n;return e&&(t="function"==typeof e?e(n):i(i({},n),e)),t},d=function(e){var n=s(e.components);return a.createElement(l.Provider,{value:n},e.children)},m={inlineCode:"code",wrapper:function(e){var n=e.children;return a.createElement(a.Fragment,{},n)}},c=a.forwardRef((function(e,n){var t=e.components,o=e.mdxType,p=e.originalType,l=e.parentName,d=r(e,["components","mdxType","originalType","parentName"]),c=s(t),u=o,k=c["".concat(l,".").concat(u)]||c[u]||m[u]||p;return t?a.createElement(k,i(i({ref:n},d),{},{components:t})):a.createElement(k,i({ref:n},d))}));function u(e,n){var t=arguments,o=n&&n.mdxType;if("string"==typeof e||o){var p=t.length,i=new Array(p);i[0]=c;var r={};for(var l in n)hasOwnProperty.call(n,l)&&(r[l]=n[l]);r.originalType=e,r.mdxType="string"==typeof e?e:o,i[1]=r;for(var s=2;s<p;s++)i[s]=t[s];return a.createElement.apply(null,i)}return a.createElement.apply(null,t)}c.displayName="MDXCreateElement"},653:(e,n,t)=>{t.r(n),t.d(n,{frontMatter:()=>r,contentTitle:()=>l,metadata:()=>s,toc:()=>d,default:()=>c});var a=t(2245),o=t(5903),p=(t(9496),t(9613)),i=["components"],r={id:"faq",title:"\u5e38\u89c1\u95ee\u9898"},l=void 0,s={unversionedId:"faq",id:"version-5.x/faq",isDocsHomePage:!1,title:"\u5e38\u89c1\u95ee\u9898",description:"\u5982\u679c\u5305\u5b58\u50a8\u5728\u5168\u5c40\u5b58\u50a8\u4e2d\uff0c\u4e3a\u4ec0\u4e48\u6211\u7684 node_modules \u4f7f\u7528\u4e86\u78c1\u76d8\u7a7a\u95f4\uff1f",source:"@site/i18n/zh/docusaurus-plugin-content-docs/version-5.x/faq.md",sourceDirName:".",slug:"/faq",permalink:"/zh/5.x/faq",editUrl:"https://crowdin.com/project/pnpm/zh-CN",tags:[],version:"5.x",frontMatter:{id:"faq",title:"\u5e38\u89c1\u95ee\u9898"}},d=[{value:"\u5982\u679c\u5305\u5b58\u50a8\u5728\u5168\u5c40\u5b58\u50a8\u4e2d\uff0c\u4e3a\u4ec0\u4e48\u6211\u7684 <code>node_modules</code> \u4f7f\u7528\u4e86\u78c1\u76d8\u7a7a\u95f4\uff1f",id:"\u5982\u679c\u5305\u5b58\u50a8\u5728\u5168\u5c40\u5b58\u50a8\u4e2d\u4e3a\u4ec0\u4e48\u6211\u7684-node_modules-\u4f7f\u7528\u4e86\u78c1\u76d8\u7a7a\u95f4",children:[],level:2},{value:"\u80fd\u7528\u4e8eWindows\u5417\uff1f",id:"\u80fd\u7528\u4e8ewindows\u5417",children:[],level:2},{value:"\u4f46\u662f\u5d4c\u5957\u7684 <code>node_modules</code> \u7ec4\u7ec7\u65b9\u5f0f\u4e0e Windows \u517c\u5bb9\u5417\uff1f",id:"\u4f46\u662f\u5d4c\u5957\u7684-node_modules-\u7ec4\u7ec7\u65b9\u5f0f\u4e0e-windows-\u517c\u5bb9\u5417",children:[],level:2},{value:"\u5faa\u73af symlinks \u5462?",id:"\u5faa\u73af-symlinks-\u5462",children:[],level:2},{value:"\u4e3a\u4ec0\u4e48\u6709\u786c\u94fe\u63a5\uff1f \u4e3a\u4ec0\u4e48\u4e0d\u76f4\u63a5\u7b26\u53f7\u94fe\u63a5\u5230\u5168\u5c40\u5b58\u50a8\uff1f",id:"\u4e3a\u4ec0\u4e48\u6709\u786c\u94fe\u63a5-\u4e3a\u4ec0\u4e48\u4e0d\u76f4\u63a5\u7b26\u53f7\u94fe\u63a5\u5230\u5168\u5c40\u5b58\u50a8",children:[],level:2},{value:"Pnpm \u662f\u5426\u53ef\u4ee5\u8de8\u591a\u4e2a\u9a71\u52a8\u5668\u6216\u6587\u4ef6\u7cfb\u7edf\u5de5\u4f5c\uff1f",id:"pnpm-\u662f\u5426\u53ef\u4ee5\u8de8\u591a\u4e2a\u9a71\u52a8\u5668\u6216\u6587\u4ef6\u7cfb\u7edf\u5de5\u4f5c",children:[{value:"\u5b58\u50a8\u8def\u5f84\u5df2\u6307\u5b9a",id:"\u5b58\u50a8\u8def\u5f84\u5df2\u6307\u5b9a",children:[],level:3},{value:"\u5b58\u50a8\u8def\u5f84\u672a\u6307\u5b9a",id:"\u5b58\u50a8\u8def\u5f84\u672a\u6307\u5b9a",children:[],level:3}],level:2},{value:"<code>pnpm store prune</code>\u7684\u4f5c\u7528\u662f\uff1f \u662f\u5426\u6709\u5bb3\uff1f",id:"pnpm-store-prune\u7684\u4f5c\u7528\u662f-\u662f\u5426\u6709\u5bb3",children:[],level:2},{value:"<code>pnpm</code> \u4ee3\u8868\u4ec0\u4e48\uff1f",id:"pnpm-\u4ee3\u8868\u4ec0\u4e48",children:[],level:2},{value:"<code>pnpm</code> does not work with &lt;YOUR-PROJECT-HERE&gt;?",id:"pnpm-does-not-work-with-your-project-here",children:[{value:"\u89e3\u51b3\u65b9\u68481",id:"\u89e3\u51b3\u65b9\u68481",children:[],level:3},{value:"\u89e3\u51b3\u65b9\u68482",id:"\u89e3\u51b3\u65b9\u68482",children:[],level:3},{value:"\u89e3\u51b3\u65b9\u68483",id:"\u89e3\u51b3\u65b9\u68483",children:[],level:3}],level:2}],m={toc:d};function c(e){var n=e.components,t=(0,o.Z)(e,i);return(0,p.kt)("wrapper",(0,a.Z)({},m,t,{components:n,mdxType:"MDXLayout"}),(0,p.kt)("h2",{id:"\u5982\u679c\u5305\u5b58\u50a8\u5728\u5168\u5c40\u5b58\u50a8\u4e2d\u4e3a\u4ec0\u4e48\u6211\u7684-node_modules-\u4f7f\u7528\u4e86\u78c1\u76d8\u7a7a\u95f4"},"\u5982\u679c\u5305\u5b58\u50a8\u5728\u5168\u5c40\u5b58\u50a8\u4e2d\uff0c\u4e3a\u4ec0\u4e48\u6211\u7684 ",(0,p.kt)("inlineCode",{parentName:"h2"},"node_modules")," \u4f7f\u7528\u4e86\u78c1\u76d8\u7a7a\u95f4\uff1f"),(0,p.kt)("p",null,"pnpm \u521b\u5efa\u4ece\u5168\u5c40\u5b58\u50a8\u5230\u9879\u76ee\u4e0b ",(0,p.kt)("inlineCode",{parentName:"p"},"node_modules")," \u6587\u4ef6\u5939\u7684 ",(0,p.kt)("a",{parentName:"p",href:"https://en.wikipedia.org/wiki/Hard_link"},"\u786c\u94fe\u63a5"),"\u3002 \u786c\u94fe\u63a5\u6307\u5411\u78c1\u76d8\u4e0a\u539f\u59cb\u6587\u4ef6\u6240\u5728\u7684\u540c\u4e00\u4f4d\u7f6e\u3002 \u56e0\u6b64\uff0c\u4f8b\u5982\uff0c\u5982\u679c\u60a8\u7684\u9879\u76ee\u4e2d ",(0,p.kt)("inlineCode",{parentName:"p"},"foo")," \u5e76\u4e14\u5b83\u5360\u7528 1MB \u7684\u7a7a\u95f4\uff0c\u90a3\u4e48\u770b\u8d77\u6765\u5b83\u5728\u9879\u76ee\u7684 ",(0,p.kt)("inlineCode",{parentName:"p"},"node_modules")," \u6587\u4ef6\u5939\u4e2d\u5360\u7528\u4e86\u4e0e\u5168\u5c40\u5b58\u50a8\u76f8\u540c\u7684 1MB \u7684\u7a7a\u95f4\u3002 \u4f46\u662f\uff0c\u8be5 1MB \u662f\u78c1\u76d8\u4e0a\u4e24\u4e2a\u4e0d\u540c\u4f4d\u7f6e\u7684",(0,p.kt)("em",{parentName:"p"},"\u76f8\u540c\u7a7a\u95f4")," \u3002 \u6240\u4ee5 ",(0,p.kt)("inlineCode",{parentName:"p"},"foo")," \u603b\u5171\u5360\u7528 1MB\uff0c\u800c\u4e0d\u662f 2MB\u3002"),(0,p.kt)("p",null,"\u83b7\u53d6\u6709\u5173\u6b64\u4e3b\u9898\u7684\u66f4\u591a\u4fe1\u606f\uff1a"),(0,p.kt)("ul",null,(0,p.kt)("li",{parentName:"ul"},(0,p.kt)("a",{parentName:"li",href:"https://unix.stackexchange.com/questions/88423/why-do-hard-links-seem-to-take-the-same-space-as-the-originals"},"\u4e3a\u4ec0\u4e48\u786c\u94fe\u63a5\u4f3c\u4e4e\u4e0e\u539f\u59cb\u94fe\u63a5\u5360\u7528\u76f8\u540c\u7684\u7a7a\u95f4\uff1f")),(0,p.kt)("li",{parentName:"ul"},(0,p.kt)("a",{parentName:"li",href:"https://gist.github.com/zkochan/106cfef49f8476b753a9cbbf9c65aff1"},"Pnpm \u804a\u5929\u5ba4\u7684\u4e00\u4e2a\u5e16\u5b50")),(0,p.kt)("li",{parentName:"ul"},(0,p.kt)("a",{parentName:"li",href:"https://github.com/pnpm/pnpm/issues/794"},"Pnpm repo\u4e2d\u7684\u4e00\u4e2a issue"))),(0,p.kt)("h2",{id:"\u80fd\u7528\u4e8ewindows\u5417"},"\u80fd\u7528\u4e8eWindows\u5417\uff1f"),(0,p.kt)("p",null,"\u77ed\u56de\u7b54\uff1a\u5f53\u7136"),(0,p.kt)("p",null,"\u957f\u7b54\u6848\uff1a\u5728 Windows \u4e0a\u4f7f\u7528\u7b26\u53f7\u94fe\u63a5\u81f3\u5c11\u53ef\u4ee5\u8bf4\u662f\u6709\u95ee\u9898\u7684\uff0c\u4f46\u662f\uff0cpnpm \u6709\u4e00\u4e2a\u89e3\u51b3\u65b9\u6cd5\u3002 \u5bf9\u4e8e Windows\uff0c\u6211\u4eec\u7528",(0,p.kt)("a",{parentName:"p",href:"https://docs.microsoft.com/en-us/windows/win32/fileio/hard-links-and-junctions"},"junctions"),"\u66ff\u4ee3\u3002"),(0,p.kt)("h2",{id:"\u4f46\u662f\u5d4c\u5957\u7684-node_modules-\u7ec4\u7ec7\u65b9\u5f0f\u4e0e-windows-\u517c\u5bb9\u5417"},"\u4f46\u662f\u5d4c\u5957\u7684 ",(0,p.kt)("inlineCode",{parentName:"h2"},"node_modules")," \u7ec4\u7ec7\u65b9\u5f0f\u4e0e Windows \u517c\u5bb9\u5417\uff1f"),(0,p.kt)("p",null,"Npm \u7684\u65e9\u671f\u7248\u672c\u7531\u4e8e\u5d4c\u5957\u4e86\u6240\u6709 ",(0,p.kt)("inlineCode",{parentName:"p"},"node_modules")," (\u53c2\u89c1 ",(0,p.kt)("a",{parentName:"p",href:"https://github.com/nodejs/node-v0.x-archive/issues/6960"},"\u8fd9\u4e2a issue"),". \u4f46\u662f\uff0cpnpm \u4e0d\u4f1a\u521b\u5efa\u6df1\u5c42\u6587\u4ef6\u5939\uff0c\u5b83\u4f7f\u7528\u7b26\u53f7\u94fe\u63a5\u6765\u521b\u5efa\u4f9d\u8d56\u5173\u7cfb\u6811\u7ed3\u6784\u3002"),(0,p.kt)("h2",{id:"\u5faa\u73af-symlinks-\u5462"},"\u5faa\u73af symlinks \u5462?"),(0,p.kt)("p",null,"\u5c3d\u7ba1 pnpm \u4f7f\u7528\u94fe\u63a5\u5c06\u4f9d\u8d56\u9879\u653e\u5165 ",(0,p.kt)("inlineCode",{parentName:"p"},"node_modules")," \u6587\u4ef6\u5939\uff0c\u5faa\u73af\u7684\u7b26\u53f7\u94fe\u63a5\u5df2\u7ecf\u88ab\u907f\u514d\u4e86\uff0c\u56e0\u4e3a\u7236\u5305\u653e\u7f6e\u5728\u5176\u4f9d\u8d56\u9879\u6240\u5728 ",(0,p.kt)("inlineCode",{parentName:"p"},"node_modules")," \u6587\u4ef6\u5939\u4e2d\u3002 \u6240\u4ee5 ",(0,p.kt)("inlineCode",{parentName:"p"},"foo"),"\u7684\u4f9d\u8d56\u9879\u4e0d\u5728 ",(0,p.kt)("inlineCode",{parentName:"p"},"foo/node_modules")," \u4e2d\uff0c",(0,p.kt)("inlineCode",{parentName:"p"},"foo")," \u5176\u5b9e\u548c\u5b83 \u4f9d\u8d56\u9879\u4e00\u8d77\u5728 ",(0,p.kt)("inlineCode",{parentName:"p"},"node_modules")," \u4e2d\u3002"),(0,p.kt)("h2",{id:"\u4e3a\u4ec0\u4e48\u6709\u786c\u94fe\u63a5-\u4e3a\u4ec0\u4e48\u4e0d\u76f4\u63a5\u7b26\u53f7\u94fe\u63a5\u5230\u5168\u5c40\u5b58\u50a8"},"\u4e3a\u4ec0\u4e48\u6709\u786c\u94fe\u63a5\uff1f \u4e3a\u4ec0\u4e48\u4e0d\u76f4\u63a5\u7b26\u53f7\u94fe\u63a5\u5230\u5168\u5c40\u5b58\u50a8\uff1f"),(0,p.kt)("p",null,"\u4e00\u53f0\u673a\u5668\u4e0a\u4e00\u4e2a\u5305\u5728\u53ef\u4ee5\u6709\u4e0d\u540c\u7684\u4f9d\u8d56\u96c6\u3002"),(0,p.kt)("p",null,"\u5728\u9879\u76ee ",(0,p.kt)("strong",{parentName:"p"},"A")," ",(0,p.kt)("inlineCode",{parentName:"p"},"foo@1.0.0")," \u53ef\u4ee5\u5177\u6709\u4e00\u4e2a\u4f9d\u8d56\u88ab\u89e3\u6790\u4e3a ",(0,p.kt)("inlineCode",{parentName:"p"},"bar@1.0.0"),"\uff0c\u4f46\u5728\u9879\u76ee ",(0,p.kt)("strong",{parentName:"p"},"B")," \u4e2d ",(0,p.kt)("inlineCode",{parentName:"p"},"foo")," \u7684\u4f9d\u8d56\u53ef\u80fd\u4f1a\u88ab\u89e3\u6790\u81f3 ",(0,p.kt)("inlineCode",{parentName:"p"},"bar@1.1.0"),"; \u56e0\u6b64\uff0cpnpm \u786c\u94fe\u63a5 ",(0,p.kt)("inlineCode",{parentName:"p"},"foo@1.0.0")," \u5230\u6bcf\u4e2a\u4f7f\u7528\u5b83\u7684\u9879\u76ee\uff0c\u4ee5\u4fbf\u4e3a\u5176\u521b\u5efa\u4e0d\u540c\u7684\u4f9d\u8d56\u9879\u96c6\u3002"),(0,p.kt)("p",null,"\u76f4\u63a5\u8f6f\u94fe\u81f3\u5168\u5c40\u5b58\u50a8\u4e0e Node \u7684 ",(0,p.kt)("inlineCode",{parentName:"p"},"--preserve-symlinks")," \u6807\u5fd7\u4e00\u8d77\u4f7f\u7528\u662f\u53ef\u884c\u7684\uff0c\u4f46\u662f\uff0c\u8be5\u65b9\u6cd5\u9644\u5e26\u4e86\u4e2a\u81ea\u5df1\u7684\u95ee\u9898\uff0c\u56e0\u6b64\u6211\u4eec\u51b3\u5b9a\u4f7f\u7528\u786c\u94fe\u63a5\u3002 \u6709\u5173\u4e3a\u4f55\u4f5c\u51fa\u51b3\u5b9a\u7684\u8be6\u60c5\uff0c\u8bf7\u53c2\u9605 ",(0,p.kt)("a",{parentName:"p",href:"https://github.com/nodejs/node-eps/issues/46"},"\u8fd9\u4e2a issue"),"\u3002"),(0,p.kt)("h2",{id:"pnpm-\u662f\u5426\u53ef\u4ee5\u8de8\u591a\u4e2a\u9a71\u52a8\u5668\u6216\u6587\u4ef6\u7cfb\u7edf\u5de5\u4f5c"},"Pnpm \u662f\u5426\u53ef\u4ee5\u8de8\u591a\u4e2a\u9a71\u52a8\u5668\u6216\u6587\u4ef6\u7cfb\u7edf\u5de5\u4f5c\uff1f"),(0,p.kt)("p",null,"\u5305\u5b58\u50a8\u5e94\u4e0e\u5b89\u88c5\u7684\u4f4d\u7f6e\u5904\u4e8e\u540c\u4e00\u9a71\u52a8\u5668\u548c\u6587\u4ef6\u7cfb\u7edf\u4e0a\uff0c\u5426\u5219\uff0c\u5305\u5c06\u88ab\u590d\u5236\uff0c\u800c\u4e0d\u662f\u88ab\u94fe\u63a5\u3002 \u8fd9\u662f\u7531\u4e8e\u786c\u94fe\u63a5\u7684\u5de5\u4f5c\u65b9\u5f0f\u5e26\u6765\u7684\u4e00\u4e2a\u9650\u5236\uff0c\u56e0\u4e3a\u4e00\u4e2a\u6587\u4ef6\u7cfb\u7edf\u4e0a\u7684\u6587\u4ef6\u65e0\u6cd5\u5bfb\u5740\u53e6\u4e00\u4e2a\u6587\u4ef6\u7cfb\u7edf\u4e2d\u7684\u4f4d\u7f6e\u3002 \u6709\u5173\u66f4\u591a\u8be6\u7ec6\u4fe1\u606f\uff0c\u8bf7\u53c2\u9605 ",(0,p.kt)("a",{parentName:"p",href:"https://github.com/pnpm/pnpm/issues/712"},"issue #712"),"\u3002"),(0,p.kt)("p",null,"pnpm \u5728\u4ee5\u4e0b\u4e24\u79cd\u60c5\u51b5\u4e0b\u7684\u529f\u80fd\u6709\u6240\u4e0d\u540c\uff1a"),(0,p.kt)("h3",{id:"\u5b58\u50a8\u8def\u5f84\u5df2\u6307\u5b9a"},"\u5b58\u50a8\u8def\u5f84\u5df2\u6307\u5b9a"),(0,p.kt)("p",null,"If the store path is specified via ",(0,p.kt)("a",{parentName:"p",href:"/zh/5.x/configuring"},"the store config"),", then copying occurs between the store and any projects that are on a different disk."),(0,p.kt)("p",null,"If you run ",(0,p.kt)("inlineCode",{parentName:"p"},"pnpm install")," on disk ",(0,p.kt)("inlineCode",{parentName:"p"},"A"),", then the pnpm store must be on disk ",(0,p.kt)("inlineCode",{parentName:"p"},"A"),". If the pnpm store is located on disk ",(0,p.kt)("inlineCode",{parentName:"p"},"B"),", then all required packages will be directly copied to the project location instead of being linked. This severely inhibits the storage and performance benefits of pnpm."),(0,p.kt)("h3",{id:"\u5b58\u50a8\u8def\u5f84\u672a\u6307\u5b9a"},"\u5b58\u50a8\u8def\u5f84\u672a\u6307\u5b9a"),(0,p.kt)("p",null,"If the store path is not set, then multiple stores are created (one per drive or filesystem)."),(0,p.kt)("p",null,"If installation is run on disk ",(0,p.kt)("inlineCode",{parentName:"p"},"A"),", the store will be created on ",(0,p.kt)("inlineCode",{parentName:"p"},"A")," ",(0,p.kt)("inlineCode",{parentName:"p"},".pnpm-store")," under the filesystem root.  If later the installation is run on disk ",(0,p.kt)("inlineCode",{parentName:"p"},"B"),", an independent store will be created on ",(0,p.kt)("inlineCode",{parentName:"p"},"B")," at ",(0,p.kt)("inlineCode",{parentName:"p"},".pnpm-store"),". The projects would still maintain the benefits of pnpm, but each drive may have redundant packages."),(0,p.kt)("h2",{id:"pnpm-store-prune\u7684\u4f5c\u7528\u662f-\u662f\u5426\u6709\u5bb3"},(0,p.kt)("inlineCode",{parentName:"h2"},"pnpm store prune"),"\u7684\u4f5c\u7528\u662f\uff1f \u662f\u5426\u6709\u5bb3\uff1f"),(0,p.kt)("p",null,"The command ",(0,p.kt)("inlineCode",{parentName:"p"},"pnpm store prune")," removes ",(0,p.kt)("em",{parentName:"p"},"unreferenced packages"),"."),(0,p.kt)("p",null,"Unreferenced packages are packages that are not used by any projects on the system. Packages can become unreferenced after most installation operations, for instance when dependencies are made redundant."),(0,p.kt)("p",null,"For example, during ",(0,p.kt)("inlineCode",{parentName:"p"},"pnpm install"),", package ",(0,p.kt)("inlineCode",{parentName:"p"},"foo@1.0.0")," is updated to ",(0,p.kt)("inlineCode",{parentName:"p"},"foo@1.0.1"),". pnpm will keep ",(0,p.kt)("inlineCode",{parentName:"p"},"foo@1.0.0")," in the store, as it does not automatically remove packages. If package ",(0,p.kt)("inlineCode",{parentName:"p"},"foo@1.0.0")," is not used by any other project on the system, it becomes unreferenced. Running ",(0,p.kt)("inlineCode",{parentName:"p"},"pnpm store prune")," would remove ",(0,p.kt)("inlineCode",{parentName:"p"},"foo@1.0.0")," from the store."),(0,p.kt)("p",null,"Running ",(0,p.kt)("inlineCode",{parentName:"p"},"pnpm store prune")," is not harmful and has no side effects on your projects. If future installations require removed packages, pnpm will download them again."),(0,p.kt)("p",null,"It is best practice to run ",(0,p.kt)("inlineCode",{parentName:"p"},"pnpm store prune")," occasionally to clean up the store, but not too frequently. Sometimes, unreferenced packages become required again. This could occur when switching branches and installing older dependencies, in which case pnpm would need to re-download all removed packages, briefly slowing down the installation process."),(0,p.kt)("h2",{id:"pnpm-\u4ee3\u8868\u4ec0\u4e48"},(0,p.kt)("inlineCode",{parentName:"h2"},"pnpm")," \u4ee3\u8868\u4ec0\u4e48\uff1f"),(0,p.kt)("p",null,(0,p.kt)("inlineCode",{parentName:"p"},"pnpm")," \u4ee3\u8868 \u9ad8\u6027\u80fd",(0,p.kt)("inlineCode",{parentName:"p"}," npm"),"\u3002 ",(0,p.kt)("a",{parentName:"p",href:"https://github.com/rstacruz/"},"@rstacruz"),"\u60f3\u51fa\u4e86\u8fd9\u4e2a\u540d\u5b57\u3002"),(0,p.kt)("h2",{id:"pnpm-does-not-work-with-your-project-here"},(0,p.kt)("inlineCode",{parentName:"h2"},"pnpm")," does not work with ","<","YOUR-PROJECT-HERE>?"),(0,p.kt)("p",null,"In most cases it means that one of the dependencies require packages not declared in ",(0,p.kt)("inlineCode",{parentName:"p"},"package.json"),". It is a common mistake caused by flat ",(0,p.kt)("inlineCode",{parentName:"p"},"node_modules"),". If this happens, this is an error in the dependency and the dependency should be fixed. That might take time though, so pnpm supports workarounds to make the buggy packages work."),(0,p.kt)("h3",{id:"\u89e3\u51b3\u65b9\u68481"},"\u89e3\u51b3\u65b9\u68481"),(0,p.kt)("p",null,"In the following example, a dependency does ",(0,p.kt)("strong",{parentName:"p"},"not")," have the ",(0,p.kt)("inlineCode",{parentName:"p"},"iterall")," module in its own list of deps."),(0,p.kt)("p",null,"The easiest solution to resolve missing dependencies of the buggy packages is to ",(0,p.kt)("strong",{parentName:"p"},"add ",(0,p.kt)("inlineCode",{parentName:"strong"},"iterall")," as a dependency to our project's ",(0,p.kt)("inlineCode",{parentName:"strong"},"package.json")),"."),(0,p.kt)("p",null,"You can do so, by installing it via ",(0,p.kt)("inlineCode",{parentName:"p"},"pnpm add iterall"),", and will be automatically added to your project's ",(0,p.kt)("inlineCode",{parentName:"p"},"package.json"),"."),(0,p.kt)("pre",null,(0,p.kt)("code",{parentName:"pre",className:"language-json"},'  "dependencies": {\n    ...\n    "iterall": "^1.2.2",\n    ...\n  }\n')),(0,p.kt)("h3",{id:"\u89e3\u51b3\u65b9\u68482"},"\u89e3\u51b3\u65b9\u68482"),(0,p.kt)("p",null,"One of the solutions is to use ",(0,p.kt)("a",{parentName:"p",href:"/zh/5.x/pnpmfile#hooks"},"hooks")," for adding the missing dependencies to the package's ",(0,p.kt)("inlineCode",{parentName:"p"},"package.json"),"."),(0,p.kt)("p",null,"An example was ",(0,p.kt)("a",{parentName:"p",href:"https://github.com/pnpm/pnpm/issues/1043"},"Webpack Dashboard")," which wasn't working with ",(0,p.kt)("inlineCode",{parentName:"p"},"pnpm"),". It has since been resolved such that it works with ",(0,p.kt)("inlineCode",{parentName:"p"},"pnpm")," now."),(0,p.kt)("p",null,"It used to throw an error:"),(0,p.kt)("pre",null,(0,p.kt)("code",{parentName:"pre",className:"language-console"},"Error: Cannot find module 'babel-traverse'\n  at /node_modules/inspectpack@2.2.3/node_modules/inspectpack/lib/actions/parse\n")),(0,p.kt)("p",null,"The problem was that ",(0,p.kt)("inlineCode",{parentName:"p"},"babel-traverse")," was used in ",(0,p.kt)("inlineCode",{parentName:"p"},"inspectpack")," which was used by ",(0,p.kt)("inlineCode",{parentName:"p"},"webpack-dashboard"),", but ",(0,p.kt)("inlineCode",{parentName:"p"},"babel-traverse")," wasn't specified in ",(0,p.kt)("inlineCode",{parentName:"p"},"inspectpack"),"'s ",(0,p.kt)("inlineCode",{parentName:"p"},"package.json"),". It still worked with ",(0,p.kt)("inlineCode",{parentName:"p"},"npm")," and ",(0,p.kt)("inlineCode",{parentName:"p"},"yarn")," because they create flat ",(0,p.kt)("inlineCode",{parentName:"p"},"node_modules"),"."),(0,p.kt)("p",null,"The solution was to create a ",(0,p.kt)("inlineCode",{parentName:"p"},"pnpmfile.js")," with the following contents:"),(0,p.kt)("pre",null,(0,p.kt)("code",{parentName:"pre",className:"language-js"},"module.exports = {\n  hooks: {\n    readPackage: (pkg) => {\n      if (pkg.name === \"inspectpack\") {\n        pkg.dependencies['babel-traverse'] = '^6.26.0';\n      }\n      return pkg;\n    }\n  }\n};\n")),(0,p.kt)("p",null,"After creating a ",(0,p.kt)("inlineCode",{parentName:"p"},"pnpmfile.js"),", delete ",(0,p.kt)("inlineCode",{parentName:"p"},"pnpm-lock.yaml")," only - there is no need to delete ",(0,p.kt)("inlineCode",{parentName:"p"},"node_modules"),", as pnpm hooks only effect module resolution. Then, rebuild the dependencies & it should be working."),(0,p.kt)("h3",{id:"\u89e3\u51b3\u65b9\u68483"},"\u89e3\u51b3\u65b9\u68483"),(0,p.kt)("p",null,"In case there are too many issues, you can use the ",(0,p.kt)("inlineCode",{parentName:"p"},"shamefully-hoist")," option. This creates a flat ",(0,p.kt)("inlineCode",{parentName:"p"},"node_modules")," structure similar to the one created by ",(0,p.kt)("inlineCode",{parentName:"p"},"npm")," or ",(0,p.kt)("inlineCode",{parentName:"p"},"yarn"),", which is not recommended as avoiding this structure is the primary purpose of pnpm's ",(0,p.kt)("inlineCode",{parentName:"p"},"node_modules")," approach."),(0,p.kt)("p",null,"To use it, try ",(0,p.kt)("inlineCode",{parentName:"p"},"pnpm install --shamefully-hoist"),"."))}c.isMDXComponent=!0}}]);